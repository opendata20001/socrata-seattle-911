{"version":3,"sources":["scripts/app-c400e222a1.js"],"names":["angular","module","directive","DataService","scope","link","element","L","Icon","Default","imagePath","map","scrollWheelZoom","maxBounds","minZoom","setView","tileLayer","attribution","addTo","icon","iconUrl","iconSize","marker","MyControl","Control","extend","options","position","onAdd","container","DomUtil","create","$","html","addControl","contentCompile","_","template","text","then","data","markers","markerClusterGroup","features","forEach","feature","parsedDate","moment","properties","event_clearance_date","format","event_clearance_description","toLowerCase","geometry","coordinates","reverse","bindPopup","addLayer","console","log","factory","$http","get","type","datum","pick","longitude","latitude"],"mappings":"AAAAA,QAAQC,OAAO,iBAAkB,sBACjCD,QAAQC,OAAO,qBAAsB,sBAClCC,UAAU,YAAa,YAAa,SAASC,GAC5C,OACEC,SACAC,KAAM,SAASD,EAAOE,GACpBC,EAAEC,KAAKC,QAAQC,UAAY,eAC3B,IAAIC,GAAMJ,EAAEI,IAAIL,EAAQ,IACtBM,iBAAiB,EACjBC,YACG,GAAI,SACJ,GAAI,SAEPC,QAAS,KACRC,SAAS,OAAQ,cAAe,GACnCR,GAAES,UAAU,8DACVC,YAAa,yJACZC,MAAMP,EAET,IAAIQ,GAAOZ,EAAEY,MACXC,QAAS,6BACTC,UAAW,IAAK,KAGlBd,GAAEe,QAAQ,OAAQ,eAChBH,KAAMA,IACLD,MAAMP,EAET,IAAIY,GAAYhB,EAAEiB,QAAQC,QACxBC,SACEC,SAAU,YAGZC,MAAO,SAAUjB,GAEf,GAAIkB,GAAYtB,EAAEuB,QAAQC,OAAO,MAAO,gBAIxC,OAFAC,GAAEH,GAAWI,KAAKD,EAAE,gBAAgBC,QAE7BJ,IAIXlB,GAAIuB,WAAW,GAAIX,GACnB,IAAIY,GAAiBC,EAAEC,SAASL,EAAE,cAAcM,OAEhDnC,KACGoC,KAAK,SAASC,GACb,GAAIC,GAAUlC,EAAEmC,oBAEhBF,GAAKG,SAASC,QAAQ,SAASC,GAC7B,GAAIC,GAAaC,OAAOF,EAAQG,WAAWC,qBAAsB,sBACjEJ,GAAQG,WAAWC,qBAAuBH,EAAWI,OAAO,2BAE5DL,EAAQG,WAAWG,4BAA8BN,EAAQG,WAAWG,4BAA4BC,aAEhG,IAAI9B,GAASf,EAAEe,OAAOuB,EAAQQ,SAASC,YAAYC,UAEnDjC,GAAOkC,UAAUrB,EAAeU,EAAQG,aACxCP,EAAQgB,SAASnC,KAGnBX,EAAI8C,SAAShB,IACZ,WACDiB,QAAQC,IAAI,gBAKxB3D,QAAQC,OAAO,wBACZ2D,QAAQ,aAAc,QAAS,SAASC,GACvC,MAAO,UAASnC,GACd,MAAOmC,GAAMC,IAAI,4LACdvB,KAAK,SAASC,GACb,OACEuB,KAAQ,oBACRpB,SAAYP,EAAEzB,IAAI6B,EAAKA,KAAM,SAASwB,GACpC,OACED,KAAQ,UACRf,WAAcZ,EAAE6B,KAAKD,GAAQ,uBAAwB,8BAA+B,yBAA0B,yBAA0B,wBAAyB,6BACjKX,UACEU,KAAQ,QACRT,aAAgBU,EAAME,UAAWF,EAAMG","file":"scripts/app-c400e222a1.js","sourcesContent":["angular.module('seahawk-crime', ['seahawk.crime-map']);\nangular.module('seahawk.crime-map', ['seahawk.crimeData'])\n  .directive('crimeMap', ['crimeData', function(DataService) {\n    return {\n      scope: {},\n      link: function(scope, element) {\n        L.Icon.Default.imagePath = 'assets/images';\n        var map = L.map(element[0], {\n          scrollWheelZoom: false,\n          maxBounds: [\n            [47, -122.2],\n            [48, -122.5]\n          ],\n          minZoom: 13\n        }).setView([47.595, -122.3321654], 14);\n        L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {\n          attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>'\n        }).addTo(map);\n\n        var icon = L.icon({\n          iconUrl: \"assets/images/seahawks.png\",\n          iconSize: [140, 62]\n        });\n\n        L.marker([47.595, -122.3321654], {\n          icon: icon\n        }).addTo(map);\n\n        var MyControl = L.Control.extend({\n          options: {\n            position: 'topright'\n          },\n\n          onAdd: function (map) {\n            // create the control container with a particular class name\n            var container = L.DomUtil.create('div', 'crime-sidebar');\n\n            $(container).html($('#sidebar-tpl').html());\n\n            return container;\n          }\n        });\n\n        map.addControl(new MyControl());\n        var contentCompile = _.template($('#popup-tpl').text());\n\n        DataService()\n          .then(function(data) {\n            var markers = L.markerClusterGroup();\n\n            data.features.forEach(function(feature) {\n              var parsedDate = moment(feature.properties.event_clearance_date, 'YYYY-MM-DDTHH:mm:ss');\n              feature.properties.event_clearance_date = parsedDate.format(\"MMM Do, YYYY [at] h:mma\");\n\n              feature.properties.event_clearance_description = feature.properties.event_clearance_description.toLowerCase();\n\n              var marker = L.marker(feature.geometry.coordinates.reverse());\n\n              marker.bindPopup(contentCompile(feature.properties));\n              markers.addLayer(marker);\n            });\n\n            map.addLayer(markers);\n          }, function() {\n            console.log('ERROR');\n          });\n      }\n    };\n  }]);\nangular.module('seahawk.crimeData', [])\n  .factory('crimeData', ['$http', function($http) {\n    return function(options) {\n      return $http.get('https://data.seattle.gov/resource/3k2p-39jp.json?$where=within_circle(incident_location, 47.593307, -122.3321654, 1609.344) AND event_clearance_date > \\'2016-01-01T00:00:00\\'&$limit=5000')\n        .then(function(data) {\n          return {\n            'type': 'FeatureCollection',\n            'features': _.map(data.data, function(datum) {\n              return {\n                'type': 'Feature',\n                'properties': _.pick(datum, ['event_clearance_date', 'event_clearance_description', 'general_offense_number', 'hundred_block_location', 'event_clearance_group', 'event_clearance_subgroup']),\n                'geometry': {\n                  'type': 'Point',\n                  'coordinates': [datum.longitude, datum.latitude]\n                }\n              }\n            })\n          };\n        });\n    }\n  }]);"],"sourceRoot":"/source/"}